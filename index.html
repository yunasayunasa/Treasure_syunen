<!DOCTYPE html>
<html>
<head>
    <!-- Phaser 3.80.1 (最新版) をCDNから読み込みます -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
    <title>Modern Mesh Test (Phaser 3.80)</title>
    <style>
        body { margin: 0; background-color: #1d1d1d; overflow: hidden; }
    </style>
</head>
<body>

<script>
class ExampleScene extends Phaser.Scene
{
    preload ()
    {
        this.load.image('character', 'https://labs.phaser.io/assets/pics/character-face.png');
    }

    create ()
    {
        const x = window.innerWidth / 2;
        const y = window.innerHeight / 2;

        // --- Phaser 3.80でのモダンなMeshオブジェクトの生成方法 ---
        const mesh = this.add.mesh({
            x: x,
            y: y,
            texture: 'character',
            // 最新版ではverticesとuvsだけで自動的に面が作られることが多いですが、
            // 明示的に指定するのが最も確実です。
            vertices: [
                { x: -128, y: -128, u: 0, v: 0 }, // 頂点0
                { x:  128, y: -128, u: 1, v: 0 }, // 頂点1
                { x: -128, y:  128, u: 0, v: 1 }, // 頂点2
                { x:  128, y:  128, u: 1, v: 1 }  // 頂点3
            ],
            faces: [
                { vertices: [ 0, 2, 3 ] },
                { vertices: [ 0, 3, 1 ] }
            ],
            // 色とアルファも頂点ごとに指定可能
            colors: [ 0xffffff, 0xffffff, 0xffffff, 0xffffff ],
            alphas: [ 1, 1, 1, 1 ]
        });
        
        // グリッド分割
        mesh.setGrid(2, 2);

        // --- 呼吸モーション ---
        const breathTween = this.tweens.add({
            targets: [ mesh.vertices[1], mesh.vertices[4] ], // 頂点オブジェクトを直接ターゲットに
            y: '-=2',
            duration: 1500,
            ease: 'Sine.easeInOut',
            yoyo: true,
            repeat: -1
        });
        
        this.add.text(10, 10, 'Phaser 3.80 Mesh Test', { color: '#ffffff' });
    }
}

const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    scene: ExampleScene
};

const game = new Phaser.Game(config);
</script>

</body>
</html>
